%% document.sty - LaTeX Document Package
%% Requires LaTeX2e format
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{document}[2025/10/01 Document Package]

%%=============================================================================
%% PACKAGE OPTIONS
%%=============================================================================

\RequirePackage{kvoptions}
\SetupKeyvalOptions{
  family=doc,
  prefix=doc@
}

% Define package options
\DeclareBoolOption[true]{theorems}
\DeclareBoolOption[true]{colors}
\DeclareBoolOption[true]{code}
\DeclareBoolOption[false]{draft}
\DeclareStringOption[ieee]{bibstyle}

\ProcessKeyvalOptions*

%%=============================================================================
%% CORE DEPENDENCIES
%%=============================================================================

%% Parsing and conditionals
\RequirePackage{xparse}
\RequirePackage{ifthen}
\RequirePackage{etoolbox}

%%=============================================================================
%% PAGE LAYOUT
%%=============================================================================

%% Geometry setup
\RequirePackage[
  margin=0.5in,
  bottom=1in,
]{geometry}

%% Headers and footers
\RequirePackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\fancyhead[C]{\leftmark}
\fancyfoot[C]{\thepage}
\setlength{\headheight}{0.5in}

%% Clean empty pages
\RequirePackage{emptypage}

%%=============================================================================
%% TEXT ENCODING AND FONTS
%%=============================================================================

%% Character encoding (load early)
\RequirePackage[utf8]{inputenc}
\RequirePackage[T1]{fontenc}
\RequirePackage{textcomp}

%%=============================================================================
%% MATHEMATICS
%%=============================================================================

%% Core math packages
\RequirePackage{amsmath}
\RequirePackage{amsfonts}
\RequirePackage{amsthm}
\RequirePackage{amssymb}
\RequirePackage{mathtools}
\RequirePackage{mathrsfs}
\RequirePackage{mathdots}

%% Additional math symbols and fonts
\RequirePackage{nicefrac}
\RequirePackage{cancel}
\RequirePackage{MnSymbol}
\RequirePackage{dsfont}
\RequirePackage{upgreek}

%% Systems of equations
\RequirePackage{systeme}

%% SI units and number formatting
\RequirePackage[locale=US]{siunitx}

%% Special symbols
\RequirePackage{pifont}

%%=============================================================================
%% COLORS AND HYPERLINKS
%%=============================================================================

\ifdoc@colors
  \RequirePackage[dvipsnames]{xcolor}
\else
  \RequirePackage{xcolor}
\fi

%% Hyperlinks (load after xcolor)
\RequirePackage[
  colorlinks=true,
  allcolors=.
]{hyperref}

%%=============================================================================
%% TEXT FORMATTING
%%=============================================================================

%% Text highlighting and spacing
\RequirePackage{soul}
\newcommand{\spaceout}[1]{\so{#1}}

%% Verbatim text
\RequirePackage{fancyvrb}

%% Quotations
\RequirePackage{csquotes}
\renewcommand{\mkbegdispquote}[2]{\itshape}

%% Enhanced lists
\RequirePackage{enumitem}

%%=============================================================================
%% CODE LISTINGS
%%=============================================================================

\ifdoc@code
  \RequirePackage{minted}
  
  %% LaTeX code environment
  \newminted{latex}{
    breaklines,
    breakanywhere,
    fontsize=\footnotesize,
    linenos=true,
    numbersep=5pt,
    frame=lines,
    framesep=2mm,
    tabsize=2,
    autogobble=true
  }
  
  %% Python code environment
  \newminted{python}{
    breaklines,
    breakanywhere,
    fontsize=\footnotesize,
    linenos=true,
    numbersep=5pt,
    frame=lines,
    framesep=2mm,
    tabsize=4,
    autogobble=true
  }
\fi

%%=============================================================================
%% TABLES
%%=============================================================================

%% Professional table formatting
\RequirePackage{booktabs}
\RequirePackage{arydshln}
\RequirePackage{multirow}
\RequirePackage{multicol}

%%=============================================================================
%% FLOATS AND CAPTIONS
%%=============================================================================

%% Float control
\RequirePackage{float}

%% Caption formatting
\RequirePackage{caption}
\RequirePackage{subcaption}
\captionsetup{
  labelfont=bf,
  labelsep=period,
  font=footnotesize
}

%%=============================================================================
%% ALGORITHMS
%%=============================================================================

\RequirePackage{algorithm}
\RequirePackage{algpseudocode}

%%=============================================================================
%% GRAPHICS AND PLOTTING
%%=============================================================================

%% Graphics inclusion
\RequirePackage{graphicx}

%% TikZ and PGFPlots
\RequirePackage{tikz}
\usetikzlibrary{
  intersections,
  angles,
  quotes,
  positioning,
  arrows.meta
}

\RequirePackage{pgfplots}
\pgfplotsset{compat=1.18}

%% Multimedia
\RequirePackage{multimedia}

%%=============================================================================
%% ADDITIONAL UTILITIES
%%=============================================================================

%% Paragraph boxes
\RequirePackage{pbox}

%% Name references
\RequirePackage{nameref}

%%=============================================================================
%% DOCUMENT STRUCTURE
%%=============================================================================

%% Appendix handling
\RequirePackage{appendix}

%% Content directory management
\newcommand{\doc@directory}{.}

\NewDocumentCommand{\setdirectory}{O{.}}{%
  \renewcommand{\doc@directory}{#1}%
}

\NewDocumentCommand{\setappendix}{O{.}}{%
  \renewcommand{\doc@directory}{#1}%
  \appendix%
  \appendixpage{}%
}

\newcommand{\addcontent}[1]{%
  \input{\doc@directory/#1}%
}

%%=============================================================================
%% BIBLIOGRAPHY
%%=============================================================================

%% Load biblatex if not already loaded
\@ifpackageloaded{biblatex}{}{%
  \RequirePackage[backend=biber, style=\doc@bibstyle]{biblatex}
}

%% Square brackets for citations
\renewcommand*{\mkbibparens}[1]{%
  \bibopenbracket#1\bibclosebracket%
}

%%=============================================================================
%% THEOREM ENVIRONMENTS
%%=============================================================================

\ifdoc@theorems

%% Theorem tools and framing
\RequirePackage{thmtools}
\RequirePackage[framemethod=TikZ]{mdframed}

%% General mdframed setup
\mdfsetup{
  skipabove=1em,
  skipbelow=0em
}

%% Set default theorem style
\theoremstyle{definition}

%%-----------------------------------------------------------------------------
%% Box Styles
%%-----------------------------------------------------------------------------

%% Helper macro for declaring box styles
\newcommand{\declarethmbox}[3]{%
  % #1 = style name, #2 = color, #3 = display name
  \declaretheoremstyle[
    headfont=\bfseries\sffamily\color{#2!70!black},
    bodyfont=\normalfont,
    mdframed={
      linewidth=2pt,
      rightline=false,
      topline=false,
      bottomline=false,
      linecolor=#2,
      backgroundcolor=#2!5,
      nobreak=false
    }
  ]{#1}
}

%% Declare colored box styles
\declarethmbox{thmredbox}{WildStrawberry}{Red}
\declarethmbox{thmorangebox}{BurntOrange}{Orange}
\declarethmbox{thmyellowbox}{Goldenrod}{Yellow}
\declarethmbox{thmgreenbox}{ForestGreen}{Green}
\declarethmbox{thmcyanbox}{Turquoise}{Cyan}
\declarethmbox{thmbluebox}{NavyBlue}{Blue}
\declarethmbox{thmpurplebox}{Violet}{Purple}
\declarethmbox{thmbrownbox}{RawSienna}{Brown}
\declarethmbox{thmgraybox}{Gray}{Gray}

%%-----------------------------------------------------------------------------
%% Theorem-like Environments
%%-----------------------------------------------------------------------------

%% Definitions
\declaretheorem[
  style=thmgreenbox,
  name=Definition,
  numberwithin=subsection
]{definition}

%% Assumptions
\declaretheorem[
  style=thmorangebox,
  name=Assumption,
  numberlike=definition
]{assumption}

%% Conjectures
\declaretheorem[
  style=thmpurplebox,
  name=Conjecture,
  numberlike=definition
]{conjecture}

%% Lemmas
\declaretheorem[
  style=thmbrownbox,
  name=Lemma,
  numberlike=definition
]{lemma}

%% Theorems
\declaretheorem[
  style=thmbrownbox,
  name=Theorem,
  numberlike=definition
]{theorem}

%% Corollaries
\declaretheorem[
  style=thmbrownbox,
  name=Corollary,
  numberlike=definition
]{corollary}

%% Propositions
\declaretheorem[
  style=thmbrownbox,
  name=Proposition,
  numberlike=definition
]{proposition}

%% Remarks
\declaretheorem[
  style=thmredbox,
  name=Remark,
  numberlike=definition
]{remark}

%% Notes
\declaretheorem[
  style=thmyellowbox,
  name=Note,
  numberlike=definition
]{note}

%% Examples
\declaretheorem[
  style=thmbluebox,
  name=Example,
  numberlike=definition
]{example}

%% Problems
\declaretheorem[
  style=thmgraybox,
  name=Problem,
  numberlike=definition
]{problem}

%% TODOs
\declaretheorem[
  style=thmcyanbox,
  name=TODO,
  numberlike=definition
]{todo}

%%-----------------------------------------------------------------------------
%% Proof and Solution Environments
%%-----------------------------------------------------------------------------

%% Custom proof environment
\renewenvironment{proof}[1][\proofname]{%
  \vspace{-11pt}%
  \pushQED{\null\hfill\(\blacksquare\)}%
  \begin{mdframed}[
    frametitle={\color{RawSienna!70!black}\sffamily\bfseries#1},
    linewidth=2pt,
    rightline=false,
    topline=false,
    bottomline=false,
    linecolor=RawSienna,
    backgroundcolor=RawSienna!2,
    nobreak=false
  ]%
}{%
  \popQED%
  \end{mdframed}%
}

%% Solution environment
\newenvironment{solution}[1][Solution]{%
  \vspace{-11pt}%
  \pushQED{\null\hfill\(\square\)}%
  \begin{mdframed}[
    frametitle={\color{NavyBlue!70!black}\sffamily\bfseries#1},
    linewidth=2pt,
    rightline=false,
    topline=false,
    bottomline=false,
    linecolor=NavyBlue,
    backgroundcolor=NavyBlue!2,
    nobreak=false
  ]%
}{%
  \popQED%
  \end{mdframed}%
}

\fi % End of \ifdoc@theorems

%%=============================================================================
%% CUSTOM COMMANDS (Optional Enhancement)
%%=============================================================================

%% Quick reference command
\newcommand{\refalg}[1]{Algorithm~\ref{#1}}
\newcommand{\reffig}[1]{Figure~\ref{#1}}
\newcommand{\reftab}[1]{Table~\ref{#1}}
\newcommand{\refdef}[1]{Definition~\ref{#1}}
\newcommand{\refass}[1]{Assumption~\ref{#1}}
\newcommand{\refconj}[1]{Conjecture~\ref{#1}}
\newcommand{\reflem}[1]{Lemma~\ref{#1}}
\newcommand{\refthm}[1]{Theorem~\ref{#1}}
\newcommand{\refcor}[1]{Corollary~\ref{#1}}
\newcommand{\refprop}[1]{Proposition~\ref{#1}}
\newcommand{\refremk}[1]{Remark~\ref{#1}}
\newcommand{\refnote}[1]{Note~\ref{#1}}
\newcommand{\refex}[1]{Example~\ref{#1}}
\newcommand{\refprob}[1]{Problem~\ref{#1}}

%%=============================================================================
%% END OF PACKAGE
%%=============================================================================

\endinput