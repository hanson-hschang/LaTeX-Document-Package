%% document.sty - LaTeX Document Package
%% Requires LaTeX2e format
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{document}[2025/10/01 Document Package]


%%=============================================================================
%% ARGUMENTS DEPENDENCIES
%%=============================================================================

%% Parsing and conditionals
\RequirePackage{xparse}
\RequirePackage{ifthen}
\RequirePackage{etoolbox}

%%=============================================================================
%% PACKAGE OPTIONS
%%=============================================================================

\RequirePackage{kvoptions}
\SetupKeyvalOptions{
  family=doc,
  prefix=doc@
}

% Define package options
\DeclareBoolOption[true]{theorems}
\DeclareBoolOption[true]{colors}
\DeclareBoolOption[true]{code}
\DeclareBoolOption[false]{draft}
\DeclareBoolOption[true]{timesfont}
\DeclareStringOption[default]{header}[default]
\DeclareStringOption[ieee]{bibstyle}

\ProcessKeyvalOptions*

%%=============================================================================
%% METADATA
%%=============================================================================

% Define the author names (short and full)
\newcommand{\@shortauthor}{}
\newcommand{\@fullauthor}{}

% Redefine \author with optional argument
\RenewDocumentCommand{\author}{o m}{%
  \IfNoValueTF{#1}%
    {% No short name provided, use full name for both
      \gdef\@shortauthor{#2}%
      \gdef\@fullauthor{#2}%
      \gdef\@author{#2}%
    }%
    {% Short name provided
      \gdef\@shortauthor{#1}%
      \gdef\@fullauthor{#2}%
      \gdef\@author{#2}%
    }%
}

% Define the titles (short and full)
\newcommand{\@shorttitle}{}
\newcommand{\@fulltitle}{}

% Redefine \title with optional argument
\RenewDocumentCommand{\title}{o m}{%
  \IfNoValueTF{#1}%
    {% No short title provided, leave \@shorttitle empty
      \gdef\@shorttitle{}%
    }%
    {% Short title provided
      \gdef\@shorttitle{#1}%
    }%
  \gdef\@fulltitle{#2}%
  \gdef\@title{#2}%
}

\newcommand{\@purpose}{}
\newcommand{\@institute}{}

% Define \purpose command
\newcommand{\purpose}[1]{%
  \gdef\@purpose{#1}%
}

% Define \institute command
\newcommand{\institute}[1]{%
  \gdef\@institute{#1}%
}

%%=============================================================================
%% PAGE LAYOUT
%%=============================================================================

%% Geometry setup
\RequirePackage[
  margin=0.5in,
  bottom=1.5in,
]{geometry}

%% Headers and footers
\RequirePackage{emptypage} % Clean empty pages
\RequirePackage{fancyhdr}  % For custom headers/footers
\pagestyle{fancy}
\fancyhf{}

% Define the handler for the header option: default
\newcommand{\doc@header@default}{%
  \fancyhead[C]{\leftmark}
  \fancyfoot[C]{\thepage}
  \setlength{\headheight}{0.75in}
}

% Define the handler for the header option: formal
\newcommand{\doc@header@formal}{%
  \RequirePackage{lastpage}  % For total page count
  \lhead{
    \@purpose \hfill \ifdefempty{\@shorttitle}{}{\@shorttitle{} --- }\@shortauthor~~\\
    \@institute \hfill page {\thepage} of {\pageref*{LastPage}}  
  }
  \setlength{\headheight}{0.75in}
  \renewcommand{\headrulewidth}{0pt}
}

% Execute the appropriate handler
\csname doc@header@\doc@header\endcsname


%%=============================================================================
%% TEXT ENCODING AND FONTS
%%=============================================================================

%% Character encoding (load early)
\RequirePackage[utf8]{inputenc}
\RequirePackage[T1]{fontenc}
\ifdoc@timesfont
  \RequirePackage{times}
\fi
\RequirePackage{textcomp}
\RequirePackage{fontawesome}    % Needed to add icons

%%=============================================================================
%% MATHEMATICS
%%=============================================================================

%% Core math packages
\RequirePackage{amsmath}
\RequirePackage{amsfonts}
\RequirePackage{amsthm}
\RequirePackage{amssymb}
\RequirePackage{mathtools}
\RequirePackage{mathrsfs}
\RequirePackage{mathdots}

%% Additional math symbols and fonts
\RequirePackage{nicefrac}
\RequirePackage{cancel}
\RequirePackage{MnSymbol}
\RequirePackage{dsfont}
\RequirePackage{upgreek}

%% Systems of equations
\RequirePackage{systeme}

%% SI units and number formatting
\RequirePackage[locale=US]{siunitx}

%% Special symbols
\RequirePackage{pifont}

%%=============================================================================
%% COLORS AND HYPERLINKS
%%=============================================================================

\ifdoc@colors
  \RequirePackage[dvipsnames]{xcolor}
\else
  \RequirePackage{xcolor}
\fi

%% Hyperlinks (load after xcolor)
\RequirePackage[
  colorlinks=true,
  allcolors=.
]{hyperref}

%%=============================================================================
%% TEXT FORMATTING
%%=============================================================================

%% Text highlighting and spacing
\RequirePackage{soul}
\newcommand{\spaceout}[1]{\so{#1}}

%% Verbatim text
\RequirePackage{fancyvrb}

%% Quotations
\RequirePackage{csquotes}
\renewcommand{\mkbegdispquote}[2]{\itshape}

%% Enhanced lists
\RequirePackage{enumitem}

%%=============================================================================
%% CODE LISTINGS
%%=============================================================================

\ifdoc@code
  \RequirePackage{minted}
  
  %% LaTeX code environment
  \newminted{latex}{
    breaklines,
    breakanywhere,
    fontsize=\footnotesize,
    linenos=true,
    numbersep=5pt,
    frame=lines,
    framesep=2mm,
    tabsize=2,
    autogobble=true
  }
  
  %% Python code environment
  \newminted{python}{
    breaklines,
    breakanywhere,
    fontsize=\footnotesize,
    linenos=true,
    numbersep=5pt,
    frame=lines,
    framesep=2mm,
    tabsize=4,
    autogobble=true
  }
\fi

%%=============================================================================
%% TABLES
%%=============================================================================

%% Professional table formatting
\RequirePackage{booktabs}
\RequirePackage{arydshln}
\RequirePackage{multirow}
\RequirePackage{multicol}

%%=============================================================================
%% FLOATS AND CAPTIONS
%%=============================================================================

%% Float control
\RequirePackage{float}

%% Caption formatting
\RequirePackage{caption}
\RequirePackage{subcaption}
\captionsetup{
  labelfont=bf,
  labelsep=period,
  font=footnotesize
}

%%=============================================================================
%% ALGORITHMS
%%=============================================================================

\RequirePackage{algorithm}
\RequirePackage{algpseudocode}

%%=============================================================================
%% GRAPHICS AND PLOTTING
%%=============================================================================

%% Graphics inclusion
\RequirePackage{graphicx}

%% TikZ and PGFPlots
\RequirePackage{tikz}
\usetikzlibrary{
  intersections,
  angles,
  quotes,
  positioning,
  arrows.meta
}

\RequirePackage{pgfplots}
\pgfplotsset{compat=1.18}

%% Multimedia
\RequirePackage{multimedia}

%%=============================================================================
%% ADDITIONAL UTILITIES
%%=============================================================================

%% Paragraph boxes
\RequirePackage{pbox}

%% Name references
\RequirePackage{nameref}

%%=============================================================================
%% DOCUMENT STRUCTURE
%%=============================================================================

%% Appendix handling
\RequirePackage{appendix}

%% Content directory management
\newcommand{\doc@directory}{.}

\NewDocumentCommand{\setdirectory}{O{.}}{%
  \renewcommand{\doc@directory}{#1}%
}

\NewDocumentCommand{\setappendix}{O{.}}{%
  \renewcommand{\doc@directory}{#1}%
  \appendix%
  \appendixpage{}%
}

\newcommand{\addcontent}[1]{%
  \input{\doc@directory/#1}%
}

%%=============================================================================
%% BIBLIOGRAPHY
%%=============================================================================

%% Load biblatex if not already loaded
\@ifpackageloaded{biblatex}{}{%
  \RequirePackage[backend=biber, style=\doc@bibstyle]{biblatex}
}

%% Square brackets for citations
\renewcommand*{\mkbibparens}[1]{%
  \bibopenbracket#1\bibclosebracket%
}

%%=============================================================================
%% THEOREM ENVIRONMENTS
%%=============================================================================

\ifdoc@theorems

%% Theorem tools and framing
\RequirePackage{thmtools}
\RequirePackage[most]{tcolorbox}
% Use the most option to load commonly used libraries, including
% skins - for enhanced visual styles and effects
% breakable - allows boxes to break across pages
% hooks - for customization hooks
% fitting - for content fitting options
% magazine - for advanced layout features
% raster - for arranging multiple boxes in grids
% theorems - provides integration with theorem environments

\tcbuselibrary{theorems}

%% Set default theorem style
\theoremstyle{definition}

%%-----------------------------------------------------------------------------
%% Box Styles
%%-----------------------------------------------------------------------------

%% Helper macro for declaring box styles with tcolorbox
%% Some examples: https://liam.page/2016/07/22/using-the-tcolorbox-package-to-create-a-new-theorem-environment/
\newcommand{\declarecolorbox}[2]{%
  % #1 = style name, #2 = color
  \tcbset{
    #1/.style={
      enhanced,
      breakable,
      colback=#2!5,
      colframe=#2,
      boxrule=-0.01pt,
      leftrule=2pt,
      sharp corners,
      left=2mm,
      right=2mm,
      fonttitle=\bfseries\sffamily,
      coltitle=#2!70!black,
      attach title to upper={~},
      separator sign={},
      description delimiters={(}{)},
      description font=\mdseries, % medium series, i.e. non-bold
    }
  }%
}

%% Declare colored box styles
\declarecolorbox{thmredbox}{WildStrawberry}
\declarecolorbox{thmorangebox}{BurntOrange}
\declarecolorbox{thmyellowbox}{Goldenrod}
\declarecolorbox{thmgreenbox}{ForestGreen}
\declarecolorbox{thmcyanbox}{Turquoise}
\declarecolorbox{thmbluebox}{NavyBlue}
\declarecolorbox{thmpurplebox}{Violet}
\declarecolorbox{thmbrownbox}{RawSienna}
\declarecolorbox{thmgraybox}{Gray}

%%-----------------------------------------------------------------------------
%% Theorem-like Environments
%%-----------------------------------------------------------------------------


%% Definitions
\newtcbtheorem[number within=subsection]{definition}{Definition}{thmgreenbox}{def}

%% Assumptions
\newtcbtheorem[use counter from=definition]{assumption}{Assumption}{thmorangebox}{asm}

%% Conjectures
\newtcbtheorem[use counter from=definition]{conjecture}{Conjecture}{thmpurplebox}{conj}

%% Lemmas
\newtcbtheorem[use counter from=definition]{lemma}{Lemma}{thmbrownbox}{lem}

%% Theorems
\newtcbtheorem[use counter from=definition]{theorem}{Theorem}{thmbrownbox}{thm}

%% Corollaries
\newtcbtheorem[use counter from=definition]{corollary}{Corollary}{thmbrownbox}{cor}

%% Propositions
\newtcbtheorem[use counter from=definition]{proposition}{Proposition}{thmbrownbox}{prop}

%% Remarks
\newtcbtheorem[use counter from=definition]{remark}{Remark}{thmredbox}{remk}

%% Notes
\newtcbtheorem[use counter from=definition]{note}{Note}{thmyellowbox}{note}

%% Examples
\newtcbtheorem[use counter from=definition]{example}{Example}{thmbluebox}{ex}

%% Problems
\newtcbtheorem[use counter from=definition]{problem}{Problem}{thmgraybox}{prob}

%% ToDos
\newtcbtheorem[use counter from=definition]{todo}{ToDo}{thmcyanbox}{todo}

%%-----------------------------------------------------------------------------
%% Proof and Solution Environments
%%-----------------------------------------------------------------------------

%% Proof tcolorbox style
\tcbset{
  proofstyle/.style={
    enhanced,
    breakable,
    colback=RawSienna!2,
    colframe=RawSienna,
    boxrule=-0.1pt,
    leftrule=2pt,
    sharp corners,
    left=2mm,
    right=2mm,
    fonttitle=\bfseries\sffamily,
    coltitle=RawSienna!70!black,
    attach title to upper={\par\noindent},
  }
}

%% Custom proof environment
\renewenvironment{proof}[1][\proofname]{%
  \par\removelastskip\vspace{-\baselineskip+2mm}%
  \pushQED{\null\hfill\(\blacksquare\)}%
  \begin{tcolorbox}[
    proofstyle, 
    title=#1, 
  ]%
}{%
  \popQED%
  \end{tcolorbox}%
}

%% Solution tcolorbox style
\tcbset{
  solutionstyle/.style={
    enhanced,
    breakable,
    colback=NavyBlue!2,
    colframe=NavyBlue,
    boxrule=-0.01pt,
    leftrule=2pt,
    sharp corners, 
    before skip=0pt,
    left=2mm,
    right=2mm,
    fonttitle=\bfseries\sffamily,
    coltitle=NavyBlue!70!black,
    attach title to upper={\par\noindent},
  }
}

%% Solution environment
\newenvironment{solution}[1][Solution]{%
  \par\removelastskip\vspace{-\baselineskip+2mm}%
  \pushQED{\null\hfill\(\square\)}%
  \begin{tcolorbox}[
    solutionstyle, 
    title=#1, 
  ]%
}{%
  \popQED%
  \end{tcolorbox}%
}

\newcommand{\refdef}[1]{Definition~\ref{def:#1}}
\newcommand{\refasm}[1]{Assumption~\ref{asm:#1}}
\newcommand{\refconj}[1]{Conjecture~\ref{conj:#1}}
\newcommand{\reflem}[1]{Lemma~\ref{lem:#1}}
\newcommand{\refthm}[1]{Theorem~\ref{thm:#1}}
\newcommand{\refcor}[1]{Corollary~\ref{cor:#1}}
\newcommand{\refprop}[1]{Proposition~\ref{prop:#1}}
\newcommand{\refremk}[1]{Remark~\ref{remk:#1}}
\newcommand{\refnote}[1]{Note~\ref{note:#1}}
\newcommand{\refex}[1]{Example~\ref{ex:#1}}
\newcommand{\refprob}[1]{Problem~\ref{prop:#1}}
\newcommand{\reftodo}[1]{ToDo~\ref{todo:#1}}

\fi % End of \ifdoc@theorems

%%=============================================================================
%% CUSTOM COMMANDS (Optional Enhancement)
%%=============================================================================

%% Quick label and reference command
\newcommand{\labelalg}[1]{\label{alg:#1}}
\newcommand{\labelfig}[1]{\label{fig:#1}}
\newcommand{\labeltab}[1]{\label{tab:#1}}
\newcommand{\refalg}[1]{Algorithm~\ref{alg:#1}}
\newcommand{\reffig}[1]{Figure~\ref{fig:#1}}
\newcommand{\reftab}[1]{Table~\ref{tab:#1}}

%%=============================================================================
%% END OF PACKAGE
%%=============================================================================

\endinput